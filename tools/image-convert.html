<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>åœ¨çº¿å›¾ç‰‡æ ¼å¼è½¬æ¢å·¥å…· - Datxy</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <nav class="navbar">
        <a href="../index.html" class="logo">Datxy</a>
        <div class="nav-links"><a href="../index.html">è¿”å›é¦–é¡µ</a></div>
    </nav>

    <div class="container">
        <h2>å›¾ç‰‡æ ¼å¼è½¬æ¢</h2>
        
        <div class="tool-box">
            <div style="text-align: center; border: 2px dashed var(--border-color); padding: 30px; border-radius: 8px; margin-bottom: 20px;">
                <input type="file" id="imgInput" accept="image/*" style="display: none;" onchange="loadFile(this)">
                <button onclick="document.getElementById('imgInput').click()" style="font-size: 1.1rem;">ğŸ“ ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡</button>
                <p id="fileInfo" style="margin-top: 10px; color: var(--text-secondary); font-size: 0.9rem;">æ”¯æŒ PNG, JPG, WEBP, BMP</p>
            </div>

            <div id="controls" style="display: none; align-items: center; gap: 15px; flex-wrap: wrap; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                <div>
                    <label>ç›®æ ‡æ ¼å¼ï¼š</label>
                    <select id="formatSelect" style="padding: 5px; border-radius: 4px; background: #000; color: #fff; border: 1px solid var(--border-color);">
                        <option value="image/png">PNG (æ— æŸ)</option>
                        <option value="image/jpeg">JPG (é€‚åˆç…§ç‰‡)</option>
                        <option value="image/webp" selected>WEBP (ç½‘é¡µæ¨è)</option>
                    </select>
                </div>
                
                <div>
                    <label>è´¨é‡ (0-1)ï¼š</label>
                    <input type="number" id="qualityInput" value="0.9" step="0.1" max="1" min="0.1" style="width: 60px;">
                </div>

                <button onclick="convertImage()">âš¡ å¼€å§‹è½¬æ¢</button>
            </div>

            <div id="resultArea" style="margin-top: 20px; display: none; text-align: center;">
                <p style="color: var(--accent-color); margin-bottom: 10px;">âœ… è½¬æ¢æˆåŠŸï¼ç‚¹å‡»å›¾ç‰‡æˆ–ä¸‹æ–¹æŒ‰é’®ä¸‹è½½</p>
                <img id="previewImg" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.3);">
                <br><br>
                <a id="downloadLink" class="tool-box" style="display: inline-block; background: var(--accent-color); color: #000; padding: 10px 30px; border: none; font-weight: bold;">â¬‡ï¸ ä¸‹è½½å›¾ç‰‡</a>
            </div>
        </div>
    </div>

    <script>
        let originalImg = null;

        function loadFile(input) {
            const file = input.files[0];
            if(!file) return;
            
            document.getElementById('fileInfo').innerText = `å·²é€‰: ${file.name} (${(file.size/1024).toFixed(1)} KB)`;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                originalImg = new Image();
                originalImg.src = e.target.result;
                originalImg.onload = () => {
                    document.getElementById('controls').style.display = 'flex';
                    document.getElementById('resultArea').style.display = 'none';
                }
            }
            reader.readAsDataURL(file);
        }

        function convertImage() {
            if(!originalImg) return;

            const format = document.getElementById('formatSelect').value;
            const quality = parseFloat(document.getElementById('qualityInput').value);

            // ä½¿ç”¨ Canvas è¿›è¡Œè½¬æ¢
            const canvas = document.createElement('canvas');
            canvas.width = originalImg.width;
            canvas.height = originalImg.height;
            const ctx = canvas.getContext('2d');
            
            // å¦‚æœè½¬ JPGï¼ŒCanvas é€æ˜èƒŒæ™¯ä¼šå˜é»‘ï¼Œæ‰€ä»¥å…ˆå¡«ç™½åº•
            if(format === 'image/jpeg') {
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
            
            ctx.drawImage(originalImg, 0, 0);

            // å¯¼å‡ºæ–°æ ¼å¼
            const newDataUrl = canvas.toDataURL(format, quality);
            
            // æ˜¾ç¤ºç»“æœ
            const preview = document.getElementById('previewImg');
            preview.src = newDataUrl;
            
            const link = document.getElementById('downloadLink');
            link.href = newDataUrl;
            // è‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶åï¼Œä¾‹å¦‚ image_converted.webp
            const ext = format.split('/')[1];
            link.download = `converted_image.${ext}`;
            
            document.getElementById('resultArea').style.display = 'block';
        }
    </script>
</body>
</html>
